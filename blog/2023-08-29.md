---
slug: ada-and-pda
title: ada 和 pda 使用
authors: [v1xingyue]
tags: [blog, blockchain, solana, co-learn]
---

在solana的数据账号使用过程中，牵扯两种账号

- PDA createProgramAddressSync
- ADA createWithSeed

本文主要分析这两种账号的异同。

## 地址生成逻辑介绍如下

- PDA 地址生成规则

1. buffer = [seed,programId,"ProgramDerivedAddress"]
2. 对buffer 取 sha256
3. 如果在曲线上，那么抛出error, 如果不在，那么直接返回作为 使用地址

[createProgramAddressSync](https://github.com/solana-labs/solana-web3.js/blob/ae1056366cd75fea784e9146af511302d5a62845/packages/library-legacy/src/publickey.ts#L168)

- ADA 生成

1. buffer=[fromPublicKey,seed,programId]
2. buffer 取 sha256, 直接返回

[createWithSeed](https://github.com/solana-labs/solana-web3.js/blob/ae1056366cd75fea784e9146af511302d5a62845/packages/library-legacy/src/publickey.ts#L150)

区别在于，数据的托管使用逻辑.

- ADA 数据签名权限，在于账户本身。即 我的数据我做主，未经允许(我未签名)不能修改。
- PDA 数据签名权限在于合约。经过程序签名，可以修改 account 的数据和提取其中的sol。

## ADA 账号使用

数据操作，有配套的函数对应，内部包含 xxxxWithSeedParams 类型的参数，完成对应的操作。
操作数据，需要 主账户的签名，这一点决定了，账号的真实所有权。

- SystemProgram.createAccountWithSeed 初始化账号
- SystemProgram.assign 重新分配owner
- SystemProgram.allocate 分配空间
- SystemProgram.nsfer 转移SOL

## PDA 账号使用

- 客户端只用于账户地址推导，不能初始化。初始化过程在合约内部完成。
- 因其签名权限，必须在合约内部完成。他的操作权限完全属于智能合约。

## ADA 账号使用 example

```typescript
  const seed = "ada.creator";

  // 初始化ada 账户
  let ada_account = await web3.PublicKey.createWithSeed(
    signer.publicKey,
    seed,
    program
  );
  console.log("ada_account address: ", ada_account.toBase58());

  let ada_info = await connection.getAccountInfo(ada_account);

  // 根据是否存在账号，决定是否初始化
  if (ada_info) {
    console.log(ada_info);
  } else {
    console.log("ada account not found");
    const transaction = new web3.Transaction().add(
      web3.SystemProgram.createAccountWithSeed({
        newAccountPubkey: ada_account,
        fromPubkey: signer.publicKey,
        basePubkey: signer.publicKey,
        programId: program,
        seed,
        lamports: web3.LAMPORTS_PER_SOL,
        space: 20,
      })
    );

```

## PDA 使用 example

客户端部分代码逻辑

```typescript

```

合约部分代码逻辑

```rust

```
